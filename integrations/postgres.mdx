---
title: "Postgres"
icon: "database"
---

Connect PostgreSQL databases to Tembo for performance monitoring and optimization.

# Features

- **Monitor slow queries** - Identifies queries that exceed performance thresholds and suggests optimizations
- **Detect missing indexes** - Analyzes query patterns to find opportunities for new indexes that would improve performance
- **Detect unused indexes** - Identifies indexes that are no longer being used, helping reduce storage overhead and write performance impact
- **Automatic optimization PRs** - Generates pull requests with database migration scripts to implement recommended improvements
- **Task-based data access** - Postgres MCP enables Tembo to query your database when needed for specific tasks (always read-only)

# Installation

<Steps>
  <Step title="Create User (Optional)">
    **Optional:** Create a dedicated database user for Tembo to ensure read-only access.
    While not strictly necessary, this is recommended for additional security assurance.
    The user needs access to PostgreSQL system catalogs and statistics views.
    
    **Example SQL:**
    ```sql
    CREATE USER tembo_monitor WITH PASSWORD 'your-secure-password';
    GRANT CONNECT ON DATABASE your_database TO tembo_monitor;
    GRANT USAGE ON SCHEMA public TO tembo_monitor;
    GRANT SELECT ON ALL TABLES IN SCHEMA public TO tembo_monitor;
    ```
  </Step>
  <Step title="Connect">
    Navigate to the [Integrations page](https://app.tembo.io/integrations) in
    Tembo and click the `Connect` button next to Postgres. Enter your connection
    string in the format: `postgresql://username:password@host:5432/database`
  </Step>
  <Step title="Test Connection">
    Test the connection to verify Tembo can access your database. Once verified,
    monitoring begins immediately.
  </Step>
  <Step title="Map Repository">
    Map your database connection to the GitHub, GitLab, or Bitbucket repository where your database migrations are stored. This allows Tembo to create PRs with optimization suggestions.
  </Step>
</Steps>

# Usage

## Automated Monitoring

Once connected, Tembo continuously monitors your database performance:

- **Query Performance Analysis** - Tracks slow queries using PostgreSQL's `pg_stat_statements` extension
- **Index Analysis** - Examines query execution plans to identify missing or unused indexes
- **Performance Trends** - Monitors query performance over time to detect degradation

## Pull Requests for Optimizations

When Tembo identifies optimization opportunities, it will:

1. **Create a Pull Request** - Opens a PR with database migration scripts (e.g., `CREATE INDEX` statements)
2. **Add Context** - Includes detailed explanations of the performance issue and expected improvement
3. **Provide Metrics** - Shows query execution times and estimated performance gains

**Example PR Description:**
```
Add index on users.email for faster lookups

This index will improve the performance of queries filtering by email,
reducing query time from ~150ms to ~5ms for email-based lookups.
```

## Postgres MCP Integration

Beyond performance monitoring, Tembo's **Postgres MCP (Model Context Protocol)** may access your database during task execution. This happens when Tembo determines that querying your database would help complete a specific task more effectively.

The MCP is powered by [crystaldba/postgres-mcp](https://github.com/crystaldba/postgres-mcp) and runs in **restricted mode**, ensuring read-only access.

**Key Points:**
- **Restricted Mode** - Runs in read-only mode, preventing any data modification operations
- **Open Source** - Built on the crystaldba/postgres-mcp implementation
- **Task-Driven** - Only accesses data when relevant to the current task being performed
- **Same Connection** - Uses the same database connection and permissions you've configured
- **Transparent** - You'll be informed when Tembo accesses your database for task completion

## Best Practices

- **Use Read-Only Access** - Tembo only needs read access to monitor performance; it never modifies your database directly
- **Monitor Production Databases** - Connect production databases for the most accurate performance insights
- **Review Migration Scripts** - Always review Tembo's suggested migrations before merging, especially for large tables
- **Test in Staging** - Apply migrations to a staging environment first to verify performance improvements
- **Enable pg_stat_statements** - Ensure the `pg_stat_statements` extension is enabled for comprehensive query analysis. Enable it by running `CREATE EXTENSION IF NOT EXISTS pg_stat_statements;` in your database. If the extension isn't available, add `pg_stat_statements` to `shared_preload_libraries` in your `postgresql.conf` and restart PostgreSQL.

## Troubleshooting

### Connection Failed

If Tembo cannot connect to your database:

1. **Verify connection string format** - Ensure the format is `postgresql://username:password@host:port/database`
2. **Check network access** - Confirm your database allows connections from Tembo's IP addresses
3. **Test credentials locally** - Use `psql` with the same connection string to verify credentials work
4. **Review SSL requirements** - Some databases require SSL; add `?sslmode=require` to your connection string if needed

### No Query Statistics Available

If Tembo reports no slow queries or missing index suggestions:

1. **Enable pg_stat_statements** - Run `CREATE EXTENSION IF NOT EXISTS pg_stat_statements;`
2. **Check extension availability** - If the above fails, add `pg_stat_statements` to `shared_preload_libraries` in `postgresql.conf` and restart PostgreSQL
3. **Verify permissions** - Ensure the Tembo user has `SELECT` access to `pg_stat_statements` views
4. **Wait for data collection** - Statistics accumulate over time; allow several hours of normal database activity

### Optimization PRs Not Being Created

If Tembo detects issues but doesn't create pull requests:

1. **Verify repository mapping** - Check that your database is mapped to the correct repository on the Integrations page
2. **Confirm repository permissions** - Ensure Tembo has write access to create branches and PRs in the mapped repository
3. **Check for existing PRs** - Tembo may skip creating duplicate PRs for already-addressed issues
